<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>{$Think.config.sitename}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" href="{$Think.HTML_STATIC}/css/mui.css">
    <link rel="stylesheet" type="text/css" href="{$Think.HTML_STATIC}/css/icons-extra.css" />
    <link href="{$Think.HTML_STATIC}/css/goods.css?v=1.1.0" rel="stylesheet">
    <link href="{$Think.HTML_STATIC}/css/iconfont.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/jquery/2.1.4/jquery.min.js"></script>
    <script src="{$Think.HTML_STATIC}/js/mui.min.js"></script>

    <style>
        /*顶部标题*/
        .mui-title{font-size: 1.7rem;color: #4a4a4a;line-height: 4.4rem;font-weight: normal;}
        #header img{width: 1rem;height: 1.75rem;margin-top: 1.25rem;}
        #header{height: 4.4rem;border-bottom: 0.05rem solid #f0f0f0;z-index: 100;}
        .mui-bar {
            -webkit-box-shadow: 0 0 1px rgba(0,0,0,0);
            box-shadow: 0 0 1px rgba(0,0,0,0);
        }
        /*导航栏*/
        .wrapper02 .scroller li.cur{color:#15BBDC;border-bottom: 0.1rem solid #15BBDC;}
        .asktop{top: 4.4rem;}


        /*.ggoods{ padding: 10px; overflow: hidden;}*/
        /*.ggoods img{ width: 25%; float: left;}*/
        .bgdstp{ width: 74%; float: right;}
        .addgnum{ float: right; font-size: 12px;}
        .gstatus{ padding:0 10px; overflow: hidden;}
        .total{ float: left; color: #ea5e5f;}
        .gstatusinfo{ float: right; font-size: 14px;}
        .gstatusinfo span{ float: right; margin-right:1rem;}
        .butt,.zfbutt{  padding:0; text-align: center; background: #56bb37; color: #fff; border-radius:5px;}
        .gorderid span{ float: right; padding-right: 1rem; font-size: 12px; color: #b7b7b7}
        .wrapper02 {position:relative;height:4.5rem;width:100%;overflow:hidden;margin:0 auto;background:#fff}
        .wrapper02 .scroller {position:absolute;width: 100%;}
        .wrapper02 .scroller ul{width: 100%;}
        .wrapper02 .scroller li {width: 16.66%; height:4.5rem;color:#333;float:left;line-height:4.5rem;font-size: 1.6rem;text-align: center}
        .wrapper02 .scroller li a{color:#868686;display:block;margin:0 .3rem}
        /* .wrapper02 .scroller li a.on10{color: #15BBDC;}*/
        /*内容*/
        .bigBox{width: 100%;overflow:scroll;}
        /*隐藏滚动条*/
        ::-webkit-scrollbar{
            display:none;
        }
        .ggoods img{width:10.3rem;border-radius: 0.5rem;height: 10.3rem;position:relative;z-index:1;}
        .gordermain{  overflow: hidden;}
        .gorderid{ padding-left: 1rem; line-height:25px; padding-bottom: 5px; font-size: 1.3rem; border-bottom: 1px solid #f7f7f7;color: #666666;}
        .gorinfo{ background: #fff;  padding: 10px 0px; margin-bottom: 10px;}
        .gorderid span.cjred{color:#ff2942;margin:0 1rem;}
        .cjagain,.butt{width: 7rem;height: 2.2rem;text-align: center; border: 1px solid #15B9DA;color: #15BBDC;background: white;border-radius: 2.2rem;line-height: 2.2rem;}
        #shhuo{border-color: #666666;color: #666666;}
        .cjprice{padding: 2.5rem 1rem 1.5rem;border-bottom: 0.05rem solid #F0F0F0;width: 100%;}
        .cjprice p span{margin:0 0.5rem;}
        .bigBox{padding: 0 1rem;}
     
       .gorderid span.dycol{color: #15BBDC;}
       .ggoods img{position:relative;z-index:1;}
        .asktop{z-index:9999;}
    </style>
</head>

<body>
<header id="header" class="mui-bar mui-bar-nav">
    <a class="mui-pull-left" id="webback" href="{:url('my/index')}"><img src="{$Think.HTML_STATIC}/images/3.png"></a>
    <h1 class="mui-title">我的订单</h1>
</header>

<div class="asktop">
    <div class="wrapper02" id="demo05">
        <div class="scroller">
            <ul class="clearfix">
                <li {if $tid==0}class="cur"{/if}><span onclick="window.location.href='{:url(\'mygoods\',[\'tid\'=>0])}'">全部</span></li>
                <li {if $tid==1}class="cur"{/if}><span onclick="window.location.href='{:url(\'mygoods\',[\'tid\'=>1])}'">待付款</span></li>
                <li {if $tid==3}class="cur"{/if}><span onclick="window.location.href='{:url(\'mygoods\',[\'tid\'=>3])}'">待收货</span></li>
                <!-- <li {if $tid==4}class="cur"{/if}><a href="{:url('getreturngoods',['tid'=>4])}">退换货</a></li> -->
                <li {if $tid==5}class="cur"{/if}><span onclick="window.location.href='{:url(\'mygoods\',[\'tid\'=>5])}'">已完成</span></li>
                <li {if $tid==6}class="cur"{/if}><span onclick="window.location.href='{:url(\'myevaluate\',[\'tid\'=>6])}'">待评价</span></li>
                <li {if $tid==7}class="cur"{/if}><span onclick="window.location.href='{:url(\'mycancelorder\',[\'tid\'=>7])}'">已取消</span></li>
            </ul>
        </div>
    </div>
</div>
<div style="height: 10rem;"></div>

<div class="gordermain">
    {volist name='$orders' id='vo' empty="<p style='text-align: center; font-size: 1.8rem; padding: 2rem;'>暂时没有相关信息~~</p>"}
    <div class="gorinfo">
        {eq name='$vo.status' value='0'}<form method="post" id="f{$vo.id}" action="{:url('goods/buy')}">{/eq}
        <div class="gorderid"><span class="dycol">
            {if $vo.cancel==1}
                已取消
            {else /}
                {eq name='$vo.status' value='0'}待付款{/eq}
                {eq name='$vo.status' value='1'}待收货{/eq}
                {eq name='$vo.status' value='2'}待收货{/eq}
                {eq name='$vo.status' value='3'}已完成{/eq}
                {eq name='$vo.status' value='4'}退换货{/eq}
                {eq name='$vo.status' value='5'}待评价{/eq}
            {/if}

        </span>单号:{$vo.order_id}</div>
        <?php $sum = 0; ?>
        <div class="bigBox" onclick="window.location.href='{:url('my/orderinfo',['oid'=>$vo.id])}'">
            <div class="ggoods">
                {volist name='$vo.orderGoods' id='vo2'}
                <?php $sum +=$vo2['nums']  ?>
                <img src="{$vo2.goods.pic}">
                <input type="hidden" name="nums[]" value="{$vo2.nums}">
                <input type="hidden" name="id[]" value="{$vo2.goods.id}">
                <input type="hidden" name="gg[]" value="{$vo2.gg}">
                <input type="hidden" name="pic[]" value="{$vo2.goods.pic}">
                {/volist}
            </div>
        </div>
        <div class="cjprice">
            <p class="mui-pull-right">
                <span>共计<?php echo $sum; ?>件商品</span><span>实付款：￥{$vo.price}元</span>
            </p>
            <div style="clear: both;"></div>
        </div>
        <div class="gstatus" style="clear: both;padding: 10px 10px;">
            <div class="total"></div>
            {eq name='$vo.status' value='0'}
            <div class="gstatusinfo">
                <input type="hidden" name="order_data_id" value="{$vo.id}">
                <span class="cancel butt" data-id="{$vo.id}">取消订单</span>
                <span class="zfbutt butt" data-id="{$vo.id}">我要支付</span>
                <span>待支付</span>
            </div>
            {/eq}

            {if $vo.status==1||$vo.status==2}
            <div class="gstatusinfo">
                <span class="butt" id="shhuo" data-id="{$vo.order_id}">确认收货</span>
                <span class="butt" onClick="window.location.href='{:url('goods/express',array('oid'=>$vo.order_id))}'">查看物流</span>
                <!-- <span>已发货</span> -->
            </div>
            <!-- <div class="gstatusinfo">
                <span class="butt" id="shhuo" data-id="{$vo.order_id}">取消订单</span>
                <span class="butt" onClick="window.location.href='{:url('goods/express',array('oid'=>$vo.order_id))}'">去支付</span>
                <span>已发货</span>
            </div> -->
            {/if}
            {eq name='$vo.status' value='3'}
            <div class="gstatusinfo">
                <span class="cjagain" onclick="window.location.href='{:url("goods/index")}'">再次购买</span>
            </div>
            {/eq}
        </div>
        {eq name='$vo.status' value='0'}
        {:token()}
    </form>
        {/eq}
    </div>
    {/volist}
</div>


<script type="text/javascript" src="{$Think.HTML_STATIC}/js/scroll.js"></script>
<script type="text/javascript" src="{$Think.HTML_STATIC}/js/navbarscroll.js"></script>
<script>
    $(function(){
    	  //判断安卓和ios文字颜色
        if (/(iPhone)/i.test(navigator.userAgent)) {
		
            $("header").css("borderColor","#cecece");

        }
        // $('#demo05').navbarscroll({
        //     defaultSelect:{$tid}
        // });
        //购买
        $('.zfbutt').click(function(){
            who=$(this).attr('data-id');
            $("#f"+who).submit();

        });
        $('.cancel').click(function(){
            var order_id = $(this).attr('data-id');
            $.ajax({
                type: "post",
                url: '{:url("docancel")}',
                data: {order_id:order_id,__token__:'{$Request.token}'},
                dataType: "json",
                success: function(data)
                {
                    if(data.code==1)
                    {
                        alert('已取消');
                        window.location.href="{:url('my/mycancelorder',['tid'=>7])}";
                    }
                    else
                    {
                        $('#loading').remove();
                        alert('取消失败');
                    }
                }
            });
        })
        //确认收货
        $('#shhuo').click(function(){
            order_id=$(this).attr('data-id');
            $.ajax({
                type: "post",
                url: '{:url("accept")}',
                data: {order_id:''+order_id+'',__token__:'{$Request.token}'},
                dataType: "json",
                success: function(data)
                {
                    if(data.code==1)
                    {
                        alert('恭喜您获得购买的商品！');
                        window.location.href="{:url('mygoods',['tid'=>5])}";
                    }
                    else
                    {
                        $('#loading').remove();
                        alert(data.msg);
                    }
                }
            });
        });
//      $(".wrapper02 .scroller li a").click(function(){
//          $(this).addClass("on10").siblings().removeClass("on10")
//      })
    });
    //订单轮播
    $(document).ready(function(){
        //获取图片的数量宽度以及box的宽度
        $(".bigBox .ggoods").each(function(m,n){
            var imgNum=$(n).find("img").length;
            var imgLen=$(n).find('img').width()
            var boxWid=imgLen*imgNum
            $(n).css("width",boxWid+30+"px")
        })
    })
    
</script>
<script src="{$Think.HTML_STATIC}/js/xback.js"></script>
<script>
    $(function () {
        backH();
        window.addEventListener('popstate',function(e){
            window.location.href="{:url('my/index')}"
        },false);


        function backH(){
            var state = {
                        title:'title',
                        url:'{:url('my/index')}'
        };
            window.history.pushState(state,'title','#');
        }
    })
</script>
</body>
</html>