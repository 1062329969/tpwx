
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{$Think.config.sitename}</title>
    <meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0,user-scalable=no" name="viewport" id="viewport">
    <meta content="yes" name="apple-mobile-web-app-capable"/>
    <meta content="black" name="apple-mobile-web-app-status-bar-style"/>
    <meta content="telephone=no" name="format-detection"/>
    <link href="{$Think.HTML_STATIC}/css/mui.css" rel="stylesheet">
    <link rel="stylesheet" href="{$Think.HTML_STATIC}/css/showimgs.css">
    <link href="{$Think.HTML_STATIC}/css/case.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="{$Think.HTML_STATIC}/css/ydui.css?rev=@@hash"/>
    <link href="{$Think.HTML_STATIC}/css/swiper-3.4.2.min.css" rel="stylesheet">
    
    <style>
        /*遮罩*/
        .mui-backdrop{z-index: 998;}
        /*顶部标题*/
        .mui-title{font-size: 1.7rem;color: #4a4a4a;line-height: 4.4rem;}
        #header img{width: 1rem;height: 1.75rem;margin-top: 1.25rem;}
        #header{height: 4.4rem;border-bottom: 0.05rem solid #f0f0f0;z-index: 100;}
        .mui-bar {
            -webkit-box-shadow: 0 0 1px rgba(0,0,0,0);
            box-shadow: 0 0 1px rgba(0,0,0,0);
        }
        .cjaddress{background: white;width: 100%;padding: 2rem 1rem 1.5rem;color: #666;font-size: 1.4rem;margin-bottom: 1rem;}
        .cjaddress-personlinfo{border-bottom: 0.05rem solid #F0F0F0;padding-bottom: 2rem;}
        .cjaddress-personlinfo span{margin-right: 0.5rem;font-size: 1.6rem;}
        .cjaddress-personlinfo .cjaddress-personlinfo-name{margin-bottom: 1.5rem;font-size: 1.4rem;}
        .cjaddress-default{padding-top: 1.5rem;}
        .cjaddress-default .mui-pull-left img{width:1.4rem;height: 1.4rem;margin-right: 1rem;margin-bottom: 0.25rem;}
        .cjaddress-default p{color: #999;}
        .cjaddress-default p.on9{color: #3bc6e2;}
        .cjaddress-default .mui-pull-right span:first-of-type img{width: 1.4rem;margin-right: 0.45rem;margin-bottom: 0.25rem;}
        .cjaddress-default .mui-pull-right span:first-of-type{margin-right: 2rem;}
        .cjaddress-default .mui-pull-right span:last-of-type img{width: 1.2rem;height: 1.6rem;margin-right: 0.45rem;margin-bottom: 0.25rem;}
        /*新建地址*/
        .cjnew{position: fixed;bottom: 0;left: 0;width: 100%;}
        .cjnew img{width: 100%;}
        /*删除的提示框*/
        .cjalert-del{width: 70%;border: 0.05rem solid #cccccc;border-radius:1rem;background: white;position: fixed;left: 15%;top: 24%;z-index: 1000;}
        .cjalert-del li{text-align: center;}
        .cjalert-del li:first-of-type{padding: 2rem 0;font-size: 1.6rem;font-weight: bold;color: #333333;}
        .cjalert-del li:nth-of-type(2){font-size: 1.4rem;color: #999999;}
        .cjalert-del li:nth-of-type(3){padding: 2rem 0;}
        .cjalert-del li:nth-of-type(3) button{padding: 0.75rem 2.25rem;color: #15BBDC;border: 0.05rem solid #15BBDC;border-radius: 2.9rem;margin: 0 1rem;}
        .cjalert-del li:nth-of-type(3) button:first-of-type{color: #FF2942;border-color: #ff2942;}
        /*新建收货地址页面*/
        .cjnew-address{width: 100%;background: white;padding:0 1rem;}
        .cjnew-address li{border-bottom: 0.05rem solid #F0F0F0;padding: 1.5rem 0;}
        .cjnew-address li span{font-size: 1.6rem;color: #333333;}
        .cjnew-address li input{font-size: 1.6rem;color: #333333;}
        .cjnew-address li img{width: 0.7rem;height: 1.3rem;margin-left: 1.1rem;}
        .cjnew-address li textarea{width: 78%;padding: 0;height: 2rem;height: 6.5rem;border: none;font-size: 1.6rem;}
        .cjhold{margin-top: 5rem;text-align: center;}
        .cjhold img{width: 86%;display: inline-block;}
        input[type=text]{margin-bottom: 0;padding: 0;border: none;}
        .cityselect-item-box > a{font-size: 1.5rem;color: #666;}
        .cityselect-nav > a{font-size: 1.5rem;margin-right: 2.5rem;}
        /*修改*/
       	.cityselect-nav > a.crt{color: #15BBDC;}
       	.cityselect-nav > a.crt:after{background-color: #15BBDC;}
       	.cityselect-item-box > a.crt{color: #15BBDC;}
       	.cityselect-item-box > a.crt:after{color: #15BBDC;}
       	.cityselect-title{font-size: 1.5rem;color: #666666;}
       	.cityselect-title:after{border-color: #D9D9D9;}
  		   /*弹窗*/
    .mui-toast-container{left:50%;margin-left: -135px;bottom: 80px;}
    </style>
</head>
<body class="bodyb">
<!--主页面-->
<div class="cjindex">
    <header id="header" class="mui-bar mui-bar-nav">
        {if $go}
        <a class=" mui-pull-left" onclick="window.location.href='{:url('goods/cart')}'"><img src="{$Think.HTML_STATIC}/images/3.png"></a>
        {else /}
        <a class=" mui-pull-left" onclick="window.location.href='{:url('my/index')}'"><img src="{$Think.HTML_STATIC}/images/3.png"></a>
        {/if}
        <h1 class="mui-title">收货地址管理</h1>
    </header>
    <div style="height: 4.4rem;"></div>
    {volist name='$list' id='vo'}

    <div class="cjaddress" id="div_{$vo.sd_id}">
        <div class="cjaddress-personlinfo">
            <div class="cjaddress-personlinfo-name"><span>{$vo.sd_username} </span><span>{$vo.sd_mobile}</span></div>
            <div><span class="province">{$vo.sd_area}</span><span class="county">{$vo.sd_address}</span></div>
            <!--<div class="cjaddress-personlinfo-name"><span>{$vo.sd_zipcode} </span></div>-->
        </div>
        <div class="cjaddress-default clearfix" >
            {if $vo.sd_default}
            <p class="mui-pull-left on9" data-id="{$vo.sd_id}"><span><img src="{$Think.HTML_STATIC}/images/37.png"/></span>设为默认地址</p>
            {else /}
            <p class="mui-pull-left" data-id="{$vo.sd_id}"><span><img src="{$Think.HTML_STATIC}/images/41.png"/></span>设为默认地址</p>
            {/if}
            <p class="mui-pull-right">
                <span class="cjedit" onclick="edit('{$vo.sd_id}','{$vo.sd_username}','{$vo.sd_mobile}','{$vo.sd_area}','{$vo.sd_address}')"><img src="{$Think.HTML_STATIC}/images/38.png"/>编辑</span>
                <span class="cjdelete" data="{$vo.sd_id}"><img src="{$Think.HTML_STATIC}/images/39.png"/>删除</span>
            </p>
        </div>
    </div>
    {/volist}
    <div style="height: 4.4rem;"></div>
    <div class="cjnew">
        <img src="{$Think.HTML_STATIC}/images/40.jpg"/>
    </div>
    <!--提示确认要删除吗？-->
    <ul class="cjalert-del" style="display: none;">
        <li>
            提示
        </li>
        <li>确认要删除吗？</li>
        <li><button class="cjdel">确认</button><button class="cjcancel">取消</button></li>
    </ul>
    <p class="mui-backdrop" style="display: none;" ></p>
</div>
<!--子页面-->

<form method="post" action="{:url('add')}" class="cjson"  id='addform' style="display: none;">
    <input name="go" type="hidden" value="{$go}" />
    <header id="header" class="mui-bar mui-bar-nav">
        <a class="mui-pull-left" onclick="showindex()"><img src="{$Think.HTML_STATIC}/images/3.png"></a>
        <h1 class="mui-title">新建收货地址</h1>
    </header>
    <div style="height: 4.4rem;"></div>
    <ul class="cjnew-address">
        <li>
            <span>收件人：</span>
            <input required="required" name="sd_username" id="sd_username" class="name" type="text" placeholder="请输入姓名" style="width: 80%;padding: 0;height: 2rem;" />
        </li>
        <li>
            <span>手机号：</span>
            <input required="required" name="sd_mobile" id="sd_mobile" class="phone" type="text" placeholder="请输入手机号" style="width: 80%;padding: 0;height: 2rem;"  />
        </li>
        <li>
            <span>选择地区：</span>
            <input required="required" name="sd_area" id="sd_area" class="cjaddress" type="text" style="width: 70%;padding: 0;height: 2rem;" placeholder="请选择收货地址"><img src="{$Think.HTML_STATIC}/images/42.png"/>
        </li>
        <li>
            <span style="vertical-align: top;">详细地址：</span>
            <textarea required="required" name="sd_address" id="sd_address" class="xxaddress" placeholder="街道丶街牌号"></textarea>
        </li>
        <!--<li>
            <span>邮编：</span>
            <input required="required" name="sd_zipcode" id="sd_zipcode" class="phone" type="text" placeholder="请输入邮编" style="width: 80%;padding: 0;height: 2rem;"  />
        </li>-->
    </ul>
    <div onclick="myaddFunction()" class="cjhold">
        <img onclick="return false;" src="{$Think.HTML_STATIC}/images/43.png"/>
    </div>
</form>

<form method="post" action="{:url('alter')}" class="cjson" id='editform' style="display: none;">
    <header id="header" class="mui-bar mui-bar-nav">
        <a class="mui-pull-left" onclick="showindex()"><img src="{$Think.HTML_STATIC}/images/3.png"></a>
        <h1 class="mui-title">新建收货地址</h1>
    </header>
    <div style="height: 4.4rem;"></div>
    <ul class="cjnew-address">
        <li>
            <span>收件人：</span>
            <input required="required" name="sd_username" id="edit_sd_username" class="name" type="text" placeholder="请输入姓名" style="width: 80%;padding: 0;height: 2rem;" />
        </li>
        <li>
            <span>手机号：</span>
            <input required="required" name="sd_mobile" id="edit_sd_mobile" class="phone" type="text" placeholder="请输入手机号" style="width: 80%;padding: 0;height: 2rem;"  />
        </li>
        <li>
            <span>选择地区：</span>
            <input required="required" name="sd_area" id="edit_sd_area" class="cjaddress" type="text" style="width: 70%;padding: 0;height: 2rem;"  placeholder="请选择收货地址"><img src="{$Think.HTML_STATIC}/images/42.png"/>
        </li>
        <li>
            <span style="vertical-align: top;">详细地址：</span>
            <textarea required="required" name="sd_address" id="edit_sd_address" class="xxaddress" placeholder="街道丶街牌号"></textarea>
        </li>
        <!--<li>
            <span>邮编：</span>
            <input required="required" name="sd_zipcode" id="edit_sd_zipcode" class="phone"  type="text" placeholder="请输入邮编" style="width: 80%;padding: 0;height: 2rem;"  />
        </li>-->
        <div onclick="myeditFunction()" class="cjhold">
            <input type="hidden" name="sd_id" id="sd_id" value="">
            <img onclick="return false;" src="{$Think.HTML_STATIC}/images/43.png"/>
        </div>
</form>
<script src="{$Think.HTML_STATIC}/js/mui.min.js"></script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.js"></script>
<script src="{$Think.HTML_STATIC}/js/web.js"></script>
<script src="{$Think.HTML_STATIC}/js/ydui.citys.js"></script>
<script src="{$Think.HTML_STATIC}/js/ydui.js"></script>
{include file="public/fx" /}
<script>
	$(".cjhold img").click(function(){
		if($(".sd_username").val()==""){
			mui.toast("请输入您的姓名",{duration:"long"})
		}
	})
	//判断安卓和ios文字颜色
        if (/(iPhone)/i.test(navigator.userAgent)) {			
            $("header").css("borderColor","#cecece");
             $(".cjaddress-personlinfo").css("borderColor","#cecece");
        }
    $(function(){
        //设置默认收货地址
        $(".cjaddress-default p.mui-pull-left").click(function(){
            var _self = $(this);
            var sd_id = $(this).attr('data-id');
            $.ajax({
                type: 'get',
                url: "{:url('setdefault')}",
                data:{sd_id:sd_id},
                dataType: "json",
                success: function(data){
                    if(data.code==1){
                        if(_self.hasClass('on9')){
                            $('.on9').removeClass('on9');
                            _self.find("img").attr("src","/static/index/images/41.png")
                        }else{
                            $('.on9').removeClass('on9');
                            $('img[src="/static/index/images/37.png"]').attr('src','/static/index/images/41.png');
                            _self.addClass("on9")
                            _self.find("img").attr("src","/static/index/images/37.png")
                        }
                    }else{
                        mui.toast("设置失败",{duration:"long"})
                    }
                }
            });
        })
        $(".cjnew img").click(function(){
            $(".cjindex").hide();
            $("#editform").hide();
            $("#addform").show();
        })
        //删除地址
        $(".cjdelete").click(function(){
            var id=$(this).attr('data');
            $(".cjdel").attr('data',id);
            $(".mui-backdrop").show()
            $(".cjalert-del").show()
            var index=$(this).closest(".cjaddress").index()
            $(".cjdel").click(function(){
                var sd_id=$(this).attr('data');
                $.ajax({
                    type: 'get',
                    url: "{:url('del')}",
                    data:{sd_id:sd_id},
                    dataType: "json",
                    success: function(data){
                        if(data.code==1){
                            $('#div_'+sd_id).remove();
                        }else{
                           mui.toast("删除失败",{duration:"long"})
                        }
                    }
                });


                $(".mui-backdrop").hide()
                $(".cjalert-del").hide()
            })
            $(".cjcancel").click(function(){
                $(".mui-backdrop").hide()
                $(".cjalert-del").hide()
            })
        })
    })
    //验证手机号
    function myaddFunction(){
        var phone=new RegExp(/^(((13[0-9]{1})|(15[0-9]{1})|(17[0-9]{1})|(18[0-9]{1}))+\d{8})$/)
        var txtVal=document.getElementById("sd_mobile").value
        var sd_username = $('#sd_username').val();
        var sd_mobile = $('#sd_mobile').val();
        var sd_area = $('#sd_area').val();
//      var sd_zipcode = $('#sd_zipcode').val();
        var sd_address = $('#sd_address').val();
		if(sd_username==''){
        	mui.toast("请输入您的姓名")
        	return false;
        }else if(sd_mobile==''){
        	mui.toast("请输入您的手机号")
        	return false;
        }else if(phone.test(txtVal)==false){
            mui.toast("请输入正确的手机号")
            return false;
        }else if(sd_area==''){
        	mui.toast("请选择您所在地区")
        	return false;
        }else if(sd_address==''){
        	mui.toast("请输入您的详细地址")
        	return false;
        }
        $("#addform").submit();
    }
    function edit(sd_id,sd_username,sd_mobile,sd_area,sd_address) {

        $('#edit_sd_username').val(sd_username);
        $('#edit_sd_mobile').val(sd_mobile);
        $('#edit_sd_area').val(sd_area);
//      $('#edit_sd_zipcode').val(sd_zipcode);
        $('#edit_sd_address').val(sd_address);
        $('#sd_id').val(sd_id);
        $(".cjindex").hide();
        $("#editform").show();
        $("#addform").hide();
    }
    function showindex(){
        $(".cjindex").show();
        $("#editform").hide();
        $("#addform").hide();
    }
    function checkvalalter(){
        var sMobile = $('#edit_sd_mobile').val();
        if(!(/^1[3|4|5|7|8][0-9]\d{4,8}$/.test(sMobile))){
            mui.toast("请输入正确的手机号",{duration:"long"})
            return false;
        }
    }
    function myeditFunction(){
        var phone=new RegExp(/^(((13[0-9]{1})|(15[0-9]{1})|(17[0-9]{1})|(18[0-9]{1}))+\d{8})$/)
        var txtVal=document.getElementById("edit_sd_mobile").value
        var sd_username = $('#edit_sd_username').val();
        var sd_mobile = $('#edit_sd_mobile').val();
        var sd_area = $('#edit_sd_area').val();
//      var sd_zipcode = $('#edit_sd_zipcode').val();
        var sd_address = $('#edit_sd_address').val();
		if(sd_username==''){
        	mui.toast("请输入您的姓名")
        	return false;
        }else if(sd_mobile==''){
        	mui.toast("请输入您的手机号")
        	return false;
        }else if(phone.test(txtVal)==false){
            mui.toast("请输入正确的手机号",{duration:"long"})
            return false;
        }else if(sd_area==''){
        	mui.toast("请选择您所在地区")
        	return false;
        }else if(sd_address==''){
        	mui.toast("请输入您的详细地址")
        	return false;
        }
        $("#editform").submit();
    }
    function del(_self,sd_id){
        layer.confirm('确定要删除?', function(index){
            $.ajax({
                type: 'get',
                url: "{:url('del')}",
                data:{sd_id:sd_id},
                dataType: "json",
                success: function(data){
                    if(data.code==1){
                        $(_self).parents('li').remove();
                        mui.toast("删除成功",{duration:"long"})
                    }else{
                         mui.toast("删除失败",{duration:"long"})
                    }
                }
            });
            layer.close(index);
        });
    }
</script>
<script>
    /**
     * 默认调用
     */
    !function () {
        var $target = $('#sd_area');

        $target.citySelect();

        $target.on('click', function (event) {
            event.stopPropagation();
            $target.citySelect('open');
        });

        $target.on('done.ydui.cityselect', function (ret) {
            $(this).val(ret.provance + ' ' + ret.city + ' ' + ret.area);
        });

        var $edittarget = $('#edit_sd_area');

        $edittarget.citySelect();

        $edittarget.on('click', function (event) {
            event.stopPropagation();
            $edittarget.citySelect('open');
        });

        $edittarget.on('done.ydui.cityselect', function (ret) {
            $(this).val(ret.provance + ' ' + ret.city + ' ' + ret.area);
        });
    }();

</script>
</body>
</html>